<!DOCTYPE html><html lang="zh-Hans"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Resize Observer使用 - 文钦的个人日志</title><meta name="keywords" content=""/><meta property="og:title" content="Resize Observer使用 - 文钦的个人日志"/><meta property="og:url"/><meta name="next-head-count" content="6"/><meta name="baidu-site-verification" content="code-qLvQxBZOZA"/><meta name="google-site-verification" content="LE9f0-2YGlWDKgo5955hV_-oeN3Uq74EN_6gcKaJ60U"/><title>文钦的个人日志</title><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta http-equiv="Cache-Control" content="no-siteapp"/><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover"/><link rel="icon" href="/favicon.ico"/><meta name="author" content="1061225829@qq.com"/><meta property="og:type" content="website"/><meta property="site_name" content="文钦的个人日志"/><meta property="og:site_name" content="文钦的个人日志"/><link rel="dns-prefetch" href="cdn.vwood.xyz"/><link rel="dns-prefetch" href="cloud.vwood.xyz"/><link rel="preload" href="/_next/static/css/d03eec8081b86b18.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d03eec8081b86b18.css" data-n-g=""/><link rel="preload" href="/_next/static/css/4174f70b245a56f7.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4174f70b245a56f7.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-97a320662e55d056.js" defer=""></script><script src="/_next/static/chunks/framework-0ba0ddd33199226d.js" defer=""></script><script src="/_next/static/chunks/main-8623703db73d68c8.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2047f9efda58b99f.js" defer=""></script><script src="/_next/static/chunks/216-7508e3954a0432df.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5Bid%5D-66e723efbbba32a9.js" defer=""></script><script src="/_next/static/kfkFZkN71VxY7dIE1lfvF/_buildManifest.js" defer=""></script><script src="/_next/static/kfkFZkN71VxY7dIE1lfvF/_ssgManifest.js" defer=""></script></head><body class="custom_class"><div id="__next"><section class="ant-layout ant-layout-has-sider style_layout__lI5tQ" id="layout"><header class="ant-layout-header"><div class="style_header__bLUBo"><nav class="style_header_left__3P86Z"><a class="style_logo-container__bUXun" href="/"><img alt="vwood" src="/images/logo.png"/></a><ul class="ant-menu-overflow ant-menu ant-menu-root ant-menu-horizontal ant-menu-light style_navs__cT4uk" role="menu" tabindex="0" data-menu-list="true"><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child style_nav-item__36GBG" style="opacity:1;order:0" role="menuitem" tabindex="-1"><span class="ant-menu-title-content">文章</span></li><li class="ant-menu-overflow-item ant-menu-item ant-menu-item-only-child style_nav-item__36GBG" style="opacity:1;order:1" role="menuitem" tabindex="-1"><span class="ant-menu-title-content">更新日志</span></li><li class="ant-menu-overflow-item ant-menu-overflow-item-rest ant-menu-submenu ant-menu-submenu-horizontal" style="opacity:0;height:0;overflow-y:hidden;order:9007199254740991;pointer-events:none;position:absolute" aria-hidden="true" role="none"><div role="menuitem" class="ant-menu-submenu-title" tabindex="-1" aria-expanded="false" aria-haspopup="true"><span role="img" aria-label="ellipsis" class="anticon anticon-ellipsis"><svg viewBox="64 64 896 896" focusable="false" data-icon="ellipsis" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"></path></svg></span><i class="ant-menu-submenu-arrow"></i></div></li></ul><div style="display:none" aria-hidden="true"></div></nav><nav class="style_header_right__66ICX"></nav></div></header><main class="ant-layout-content style_layout-content__nrtXO"><div class="style_detail_container__YiTh1"><div class="style_content__kMJ4y"><div class="style_post_container__xy1dg"><div class="style_post__STttj"><div class="style_post_content__LiFhd"><div class="style_post_header__yefRf"><h1 class="style_name__IG9VL">Resize Observer使用</h1><div class="style_base-info__kvLMe"><span class="style_item__m96GX"><i class="iconfont"></i><span>发表于 <!-- -->2021-11-05</span><div class="ant-divider ant-divider-vertical" role="separator"></div><span>更新于 <!-- -->2022-04-21</span><div class="ant-divider ant-divider-vertical" role="separator"></div><span class="view_view__gVK9p"><span>阅读量 </span><span>60</span></span></span><div></div></div></div><div><div class="style_content__kMJ4y"><div class="style_marked__AZOQ3"><div class="markdown-body"><p><code>Resize Observer</code>是一个新的JavaScript API，与<a href="https://alligator.io/js/intersection-observer/"><code>Intersection Observer API</code></a>、<a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver"><code>Mutation Observer</code></a>等其他观察者API非常相似。
它允许在尺寸发生变化时通知元素。</p>
<h5 id="基本用法">基本用法</h5>
<hr>
<p>使用Resize Observer非常简单，只需实例化一个新的ResizeObserver对象并传入一个回调函数，该函数接收观察到的条目</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> myObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function"><span class="hljs-params">entries</span> =&gt;</span> {
  <span class="hljs-comment">// iterate over the entries, do something.</span>
});</code></pre>
<p>然后，我们可以在实例上调用<code>observe</code>并传入一个元素来观察</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> someEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.some-element&#x27;</span>);
<span class="hljs-keyword">const</span> someOtherEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.some-other-element&#x27;</span>);

myObserver.<span class="hljs-title function_">observe</span>(someEl);
myObserver.<span class="hljs-title function_">observe</span>(someOtherEl);</code></pre>
<p>对于每个entry，我们都会得到一个包含<code>contentRect</code>和一个<code>target</code>属性的对象。<code>target</code>是DOM元素本身，contentRect是具有以下属性的对象：width，height，x，y，top，right，bottom和left。</p>
<p>与元素的<code>getBoundingClientRect</code>不同，<code>contentRect</code>的<code>width</code>和<code>height</code>值不包含<code>padding</code>。<code>contentRect.top</code>是元素的顶部<code>padding</code>，contentRect.left是元素的左侧<code>padding</code>。</p>
<p>比如要打印出被监听元素寸尺变化时<code>width</code>和<code>height</code>的值，可以像下面这样做:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> myObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function"><span class="hljs-params">entries</span> =&gt;</span> {
  entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;width&#x27;</span>, entry.<span class="hljs-property">contentRect</span>.<span class="hljs-property">width</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;height&#x27;</span>, entry.<span class="hljs-property">contentRect</span>.<span class="hljs-property">height</span>);
  });
});

<span class="hljs-keyword">const</span> someEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.some-element&#x27;</span>);
myObserver.<span class="hljs-title function_">observe</span>(someEl);</code></pre>
<h5 id="示例">示例</h5>
<p>下面是一个简单的演示，以查看Resize Observer API的实际应用。
通过调整浏览器窗口的大小来尝试一下，注意渐变角度和文本内容仅在元素的大小受到影响时才发生变化：</p>
<p>让我们来分解这个简单的演示。首先，我们从一些简单的标记开始：</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;box&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;box small&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>
<p>样式：</p>
<pre><code class="language-css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">20vh</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">var</span>(--subtle);

  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-class">.box</span> <span class="hljs-selector-tag">h3</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">5vmin</span>;
  <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.4</span>);
}

<span class="hljs-selector-class">.box</span><span class="hljs-selector-class">.small</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">550px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">1rem</span> auto;
}</code></pre>
<p>请注意，我们不需要将渐变背景应用于<code>.box</code>元素。
当页面第一次加载时，resize观察者将被调用一次，然后我们将应用我们的渐变。
现在，当我们添加下面的JavaScript代码时，就会发生奇迹了：</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> boxes = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;.box&#x27;</span>);

<span class="hljs-keyword">const</span> myObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function"><span class="hljs-params">entries</span> =&gt;</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> entry <span class="hljs-keyword">of</span> entries) {
    <span class="hljs-keyword">const</span> infoEl = entry.<span class="hljs-property">target</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.info&#x27;</span>);
    <span class="hljs-keyword">const</span> width = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(entry.<span class="hljs-property">contentRect</span>.<span class="hljs-property">width</span>);
    <span class="hljs-keyword">const</span> height = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(entry.<span class="hljs-property">contentRect</span>.<span class="hljs-property">height</span>);

    <span class="hljs-keyword">const</span> angle = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(width / <span class="hljs-number">360</span> * <span class="hljs-number">100</span>);
    <span class="hljs-keyword">const</span> gradient = <span class="hljs-string">`linear-gradient(<span class="hljs-subst">${ angle }</span>deg, rgba(0,143,104,1) 50%, rgba(250,224,66,1) 50%)`</span>;

    entry.<span class="hljs-property">target</span>.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = gradient;

    infoEl.<span class="hljs-property">innerText</span> = <span class="hljs-string">`I&#x27;m <span class="hljs-subst">${ width }</span>px and <span class="hljs-subst">${ height }</span>px tall`</span>;
  }
});

boxes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">box</span> =&gt;</span> {
  myObserver.<span class="hljs-title function_">observe</span>(box);
});</code></pre>
<p>在这里，我们使用for ... of循环遍历观察者回调中的条目，但在条目上调用forEach将工作得一样。
请注意，我们还必须迭代可以观察的元素，并调用每个元素的观察值。</p>
<p>####浏览器支持
浏览器支持现在非常糟糕，只有Chrome 64+支持Resize Observer开箱即用。
谢天谢地，我们可以同时使用polyfill。
该polyfill基于MutationObserver API。</p>
<p>#####参考书籍</p>
<ul>
<li><a href="https://alligator.io/js/resize-observer/">A Look at the Resize Observer JavaScript API</a></li>
</ul>
</div></div></div></div><div class="style_operations__XtOI_"></div></div></div></div><section class="style_comments__qH5Mz"></section></div><div class="style_latest__9fywH"><ul></ul></div></div></main><footer class="ant-layout-footer"><div class="style_footer__9WRvE"><div class="style_item__wDXtJ"><h2>联系</h2><div><div><div><a href="mailto:1061225829@qq.com">邮箱：1061225829@qq.com</a></div></div></div></div><div class="style_item__wDXtJ"><h2>vwood</h2><div><div><div class="style_about__2YCeI"><span>©2020 vwood</span><div class="ant-divider ant-divider-vertical" role="separator"></div><a href="/about">关于</a></div></div><div><div class="style_beian__sifwE"><span></span><a href="http://beian.miit.gov.cn/" target="_blank">蜀ICP备19030923号-1</a></div></div></div></div></div></footer><div class="ant-back-top"></div></section><div class="ant-back-top"></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"content":"```Resize Observer```是一个新的JavaScript API，与[```Intersection Observer API```](https://alligator.io/js/intersection-observer/)、[```Mutation Observer```](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver)等其他观察者API非常相似。\n它允许在尺寸发生变化时通知元素。\n\n##### 基本用法\n--------\n\n使用Resize Observer非常简单，只需实例化一个新的ResizeObserver对象并传入一个回调函数，该函数接收观察到的条目\n\n```javascript\nconst myObserver = new ResizeObserver(entries =\u003e {\n  // iterate over the entries, do something.\n});\n```\n然后，我们可以在实例上调用```observe```并传入一个元素来观察\n```javascript\nconst someEl = document.querySelector('.some-element');\nconst someOtherEl = document.querySelector('.some-other-element');\n\nmyObserver.observe(someEl);\nmyObserver.observe(someOtherEl);\n```\n\n对于每个entry，我们都会得到一个包含```contentRect```和一个```target```属性的对象。```target```是DOM元素本身，contentRect是具有以下属性的对象：width，height，x，y，top，right，bottom和left。\n\n与元素的```getBoundingClientRect```不同，```contentRect```的```width```和```height```值不包含```padding```。```contentRect.top```是元素的顶部```padding```，contentRect.left是元素的左侧```padding```。\n\n比如要打印出被监听元素寸尺变化时```width```和```height```的值，可以像下面这样做:\n```javascript\nconst myObserver = new ResizeObserver(entries =\u003e {\n  entries.forEach(entry =\u003e {\n    console.log('width', entry.contentRect.width);\n    console.log('height', entry.contentRect.height);\n  });\n});\n\nconst someEl = document.querySelector('.some-element');\nmyObserver.observe(someEl);\n```\n\n\n##### 示例\n\n下面是一个简单的演示，以查看Resize Observer API的实际应用。\n通过调整浏览器窗口的大小来尝试一下，注意渐变角度和文本内容仅在元素的大小受到影响时才发生变化：\n\n\n\n让我们来分解这个简单的演示。首先，我们从一些简单的标记开始：\n\n```html\n\u003cdiv class=\"box\"\u003e\n  \u003ch3 class=\"info\"\u003e\u003c/h3\u003e\n\u003c/div\u003e\n\u003cdiv class=\"box small\"\u003e\n  \u003ch3 class=\"info\"\u003e\u003c/h3\u003e\n\u003c/div\u003e\n```\n样式：\n```css\n.box {\n  text-align: center;\n  height: 20vh;\n  border-radius: 8px;\n  box-shadow: 0 0 4px var(--subtle);\n\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.box h3 {\n  color: #fff;\n  margin: 0;\n  font-size: 5vmin;\n  text-shadow: 0 0 10px rgba(0,0,0,0.4);\n}\n\n.box.small {\n  max-width: 550px;\n  margin: 1rem auto;\n}\n```\n\n请注意，我们不需要将渐变背景应用于```.box```元素。\n当页面第一次加载时，resize观察者将被调用一次，然后我们将应用我们的渐变。\n现在，当我们添加下面的JavaScript代码时，就会发生奇迹了：\n\n```javascript\nconst boxes = document.querySelectorAll('.box');\n\nconst myObserver = new ResizeObserver(entries =\u003e {\n  for (let entry of entries) {\n    const infoEl = entry.target.querySelector('.info');\n    const width = Math.floor(entry.contentRect.width);\n    const height = Math.floor(entry.contentRect.height);\n\n    const angle = Math.floor(width / 360 * 100);\n    const gradient = `linear-gradient(${ angle }deg, rgba(0,143,104,1) 50%, rgba(250,224,66,1) 50%)`;\n\n    entry.target.style.background = gradient;\n\n    infoEl.innerText = `I'm ${ width }px and ${ height }px tall`;\n  }\n});\n\nboxes.forEach(box =\u003e {\n  myObserver.observe(box);\n});\n```\n\n在这里，我们使用for ... of循环遍历观察者回调中的条目，但在条目上调用forEach将工作得一样。\n请注意，我们还必须迭代可以观察的元素，并调用每个元素的观察值。\n\n####浏览器支持\n浏览器支持现在非常糟糕，只有Chrome 64+支持Resize Observer开箱即用。\n谢天谢地，我们可以同时使用polyfill。\n该polyfill基于MutationObserver API。\n\n#####参考书籍\n+ [A Look at the Resize Observer JavaScript API](https://alligator.io/js/resize-observer/)","createTime":1636124983377,"description":"Resize Observer是一个新的JavaScript API，与[Intersection Observer API](https:alligator.io/js/intersection-observer/)、[Mutation Observer](https:developer.mozilla.org/en-US/docs/Web/API/M","id":"b91d22df-cec2-4ee0-b23b-89e7e43a3cc1","isDeleted":false,"likeCount":0,"name":"Resize Observer使用","operatorID":"96f16846-31f2-489c-9af0-d4ca13e836e4","tags":[],"updateTime":1650511824631,"viewCount":60},"id":"b91d22df-cec2-4ee0-b23b-89e7e43a3cc1"},"initialMobxState":{"userStore":{"currentUser":null,"users":[],"token":"","qiniuToken":"","userCount":0,"productCount":0,"commentCount":0,"settingType":"products"},"productStore":{},"commentStore":{},"noteStore":{},"askStore":{},"stypeStore":{}},"__N_SSG":true},"page":"/blogs/[id]","query":{"id":"b91d22df-cec2-4ee0-b23b-89e7e43a3cc1"},"buildId":"kfkFZkN71VxY7dIE1lfvF","isFallback":false,"gsp":true,"appGip":true,"scriptLoader":[]}</script></body></html>